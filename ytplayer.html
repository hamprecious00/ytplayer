<!DOCTYPE html>
<html>
<head>
  <title>Dual YouTube Player â€” Fixed Loop</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    #players {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 40px;
      flex-wrap: wrap;
    }
    .player {
      width: 44vw;
      height: 45vh;
      min-width: 320px;
      background: #000;
      border-radius: 10px;
      overflow: hidden;
    }
    input {
      width: 60%;
      padding: 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      font-size: 17px;
    }
    button {
      padding: 10px 18px;
      margin-left: 8px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #ff0066;
      color: white;
    }
  </style>
</head>
<body>

<h2>Dual YouTube Player</h2>
<p>Paste YouTube link below:</p>

<input id="link" placeholder="https://youtube.com/watch?v=xxxx">
<button onclick="loadVideo()">Play</button>

<div id="players">
  <div id="player1" class="player"></div>
  <div id="player2" class="player"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let p1, p2;

// Extract video ID cleanly from ANY YouTube URL
function getID(url){
  let patterns = [
    /v=([^&]+)/,
    /youtu\.be\/([^?]+)/,
    /youtube\.com\/embed\/([^?]+)/
  ];
  for (let p of patterns){
    let match = url.match(p);
    if (match) return match[1];
  }
  return null;
}

// API loads, now create the players
function onYouTubeIframeAPIReady() {
  p1 = new YT.Player("player1", {
    playerVars: { loop: 1, playlist: "" },
    events: { onStateChange: restartLoop }
  });

  p2 = new YT.Player("player2", {
    playerVars: { loop: 1, playlist: "" },
    events: { onStateChange: restartLoop }
  });
}

// Restart the video when finished
function restartLoop(e){
  if(e.data === YT.PlayerState.ENDED){
    e.target.seekTo(0);
    e.target.playVideo();
  }
}

function loadVideo(){
  let url = document.getElementById("link").value.trim();
  let id = getID(url);

  if(!id){
    alert("Invalid YouTube Link");
    return;
  }

  // Ensure loop mode works
  p1.loadVideoById({videoId: id});
  p1.setLoop(true);
  p1.setShuffle(false);

  p2.loadVideoById({videoId: id});
  p2.setLoop(true);
  p2.setShuffle(false);

  // REQUIRED for YouTube loop function:
  p1.cuePlaylist({playlist: [id]});
  p2.cuePlaylist({playlist: [id]});
}
</script>

</body>
</html>

